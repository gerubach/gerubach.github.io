---
layout: post
title: Blog Post 1 
---
*Italics* **Bold**

# header

```python 
def query_climate_database(country, year_begin, year_end, month):
    conn = sqlite3.connect("HW_1.db")
    cursor = conn.cursor()
    cmd = "SELECT `FIPS_10-4` FROM countries WHERE Name = '" + country + "'"
    abbreviation = (pd.read_sql(cmd, conn)["FIPS_10-4"])[0]
    cmd = f"SELECT S.NAME, S.LATITUDE, S.LONGITUDE, '{country}' Country, T.Year, T.Month, T.Temp \
            FROM temperatures T \
            LEFT JOIN stations S ON T.id = S.id \
            WHERE T.Year >= {year_begin} AND T.Year <= {year_end} AND T.Month = {month} AND SUBSTRING(T.id,1,2)='{abbreviation}'"
    temp = pd.read_sql(cmd, conn)
    conn.close()
    return temp

def temperature_coefficient_plot(country, year_begin, year_end, month, min_obs, **kwargs):
    months = {1 : "January", 2 : "February", 3 : "March", 4 : "April",
             5 : "May", 6 : "June", 7 : "July", 8 : "August", 9 : "September", 
             10 : "October", 11 : "November", 12 : "December"}
    plot_title = f"Estimates of yearly increase in temperature in {months[month]} for stations in {country}, years {year_begin} to {year_end}"
    data = query_climate_database(country, year_begin, year_end, month)
    names = pd.unique(data["NAME"])
    plotted_names = []
    intensity = []
    for name in names:
        years = data.loc[data["NAME"] == name, "Year"]
        if len(years) >= min_obs: 
            plotted_names.append(name)
            temps = data.loc[data["NAME"] == name, "Temp"]
            line = LinearRegression().fit(years.to_frame(), temps)
            intensity += [line.coef_[0]] * len(years)
    fig = px.scatter_mapbox(data[data["NAME"].isin(plotted_names)], lat = "LATITUDE", lon = "LONGITUDE",
                        hover_name = "NAME", color = intensity, color_continuous_midpoint = 0, 
                            title = plot_title, 
                            labels = {"color" : f"Estimated Yearly Increase ({chr(176)}C)"}, **kwargs)
    return fig
                
color_map = px.colors.diverging.RdGy_r # choose a colormap
fig = temperature_coefficient_plot("India", 1980, 2020, 1, min_obs = 10, zoom = 2,
                                    mapbox_style="carto-positron",
                                    color_continuous_scale=color_map)
fig.show()
```

{% include india_interactive.html %}

```python
fig = temperature_coefficient_plot("South Africa", 1980, 2020, 8, min_obs = 10, zoom = 2,
                                    mapbox_style="carto-positron",
                                    color_continuous_scale=color_map)
fig.show()
```

{% include south_africa_interactive.html %}

```python
#How does the average yearly change in temperature vary between countries?
def query_climate_database2(year_begin, year_end, month):
    conn = sqlite3.connect("HW_1.db")
    cursor = conn.cursor()
    cmd = f"SELECT C.Name, T.Year, T.Temp \
            FROM temperatures T \
            LEFT JOIN countries C ON SUBSTRING(T.id,1,2) = C.`FIPS_10-4` \
            WHERE T.Year >= {year_begin} AND T.Year <= {year_end} AND T.Month = {month}"
    temp = pd.read_sql(cmd, conn)
    conn.close()
    return temp

#make this a chloropleth
def global_temperatures_plot(year_begin, year_end, month, min_obs):
    months = {1 : "January", 2 : "February", 3 : "March", 4 : "April",
             5 : "May", 6 : "June", 7 : "July", 8 : "August", 9 : "September", 
             10 : "October", 11 : "November", 12 : "December"}
    plot_title = f"Estimates of yearly temperature increase in {months[month]},{'<br>'}years {year_begin} to {year_end}"
    data = query_climate_database2(year_begin, year_end, month)
    names = pd.unique(data["Name"])
    intensity = []
    plotted_names = []
    for name in names:
        years = data.loc[data["Name"] == name, "Year"]
        if len(years) >= min_obs: 
            plotted_names.append(name)
            temps = data.loc[data["Name"] == name, "Temp"]
            line = LinearRegression().fit(years.to_frame(), temps)
            intensity.append(line.coef_[0])
    fig = px.choropleth(locations = plotted_names, color = intensity, title = plot_title,
                        locationmode = "country names",
                       labels = {"color" : f"Estimated Yearly Increase ({chr(176)}C)", "locations" : "country"})
    return fig

fig = global_temperatures_plot(2000, 2020, 8, 10)
fig.show()
```

{% include global_temp_increase_interactive.html %}

```python
#How does temperature in a country change over time?
def query_climate_database3(country, years, months):
    conn = sqlite3.connect("HW_1.db")
    cursor = conn.cursor()

    cmd = f"SELECT T.Year, T.Temp, T.Month\
            FROM temperatures T \
            LEFT JOIN countries C ON SUBSTRING(T.id,1,2) = C.`FIPS_10-4` \
            WHERE C.Name = '{country}'"
    temp = pd.read_sql(cmd, conn)
    conn.close()
    temp = temp[temp["Year"].isin(years) & temp["Month"].isin(months)]
    return temp

def faceted_hist(country, years, months):
    month_conversion = {1 : "January", 2 : "February", 3 : "March", 4 : "April",
                        5 : "May", 6 : "June", 7 : "July", 8 : "August", 9 : "September", 
                        10 : "October", 11 : "November", 12 : "December"}
    months.sort()
    years.sort()
    plot_title = f"Distribution of temperatures in {country} for {'<br>'}selected years and months"
    junk = query_climate_database3(country, years, months)
    junk["Month"] = junk["Month"].apply(lambda x: month_conversion[x])
    fig = px.histogram(junk, x="Temp", facet_row = "Year", facet_col = "Month",
                      title = plot_title)
    return fig

fig = faceted_hist("Russia", [1980, 2000, 2020], [1, 7])
fig.show()
```

{% include russia_faceted_hist_interactive.html %}